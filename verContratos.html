<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!--> <html lang="es"> <!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
   <meta charset="utf-8" />
   <meta content="width=device-width, initial-scale=1.0" name="viewport" />

   <link rel="stylesheet" type="text/css" href="assets/chosen-bootstrap/chosen/chosen.css" />
   <link rel="stylesheet" type="text/css" href="assets/jquery-tags-input/jquery.tagsinput.css" />    

</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->
<body class="fixed-top">

   <!-- BEGIN CONTAINER -->
   <div id="container" class="row-fluid">
      <form class='form-horizontal'>
         <div class="control-group">
               <label class="control-label">Buscar Por:</label>
            <div class="controls">
               <select id='txtVerContratos_BuscarPor' data-placeholder="Parámetros de búsqueda" class="chosen span6" multiple="multiple" tabindex="6">
                     <option value=""></option>
                     <option value="Nombre">Nombre</option>
                     <option value="Descripcion">Descripción</option>
                     <option value='FechaInicio'>Fecha de Inicio</option>
                     <option value='FechaTerminacion'>Fecha de Terminación</option>
                     <option value='ValorContrato'>Valor del Contrato</option>
                     <option value='Objeto'>Objeto del Contrato</option>
                     <option value='Responsabilidades'>Responsabilidades del Contrato</option>
                     <option value='Contratante'>Contratante</option>
                     <option value='Contratista'>Contratista</option>
               </select>
            </div>
            <input type='hidden' id='txtVerContratos_Parametros'/>
         </div>
         <div class='row-fluid circle-state-overview'>
            <div class="control-group">
               <div class="controls">
                  <textarea id='txtVerContratos_Criterio' class="span6  tooltips" data-trigger="hover" data-original-title="Ingresa las palabras clave para realizar la búsqueda"></textarea>
               </div>
            </div>
            <div class="form-actions">
               <div id='btnVerContratos_Buscar' href="#" class="stats-circle green-color">
                  <i class="icon-search"></i>
                  <div>Buscar</div>
               </div>
            </div>
         </div>
      </form>
   </div>
   <div class="row-fluid" id="sortable_portlets">
      <div id='txtVerContratos_ContenedorResultados' class="sortable"></div>
   </div>
      
      
         
   <!-- END CONTAINER -->
   <!-- BEGIN JAVASCRIPTS -->    
  
   <!--[if lt IE 9]>
   <script src="js/excanvas.js"></script>
   <script src="js/respond.js"></script>
   <![endif]-->
   <script type="text/javascript" src="assets/jquery-tags-input/jquery.tagsinput.min.js"></script>
   <script src="assets/fancybox/source/jquery.fancybox.pack.js"></script>
   <script src="assets/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
   <script src="js/portlet-draggable.js"></script>
   <script src="customJs/verContratos.js"></script>
   <script>
      jQuery(document).ready(function() {       
         // initiate layout and plugins
         verContratos();
         $(".chosen").chosen();
         $('.tooltips').tooltip();

         function cerrarPorlet()
         {
              $(".icon-chevron-down").on("click", ocultarPortlet);

             jQuery('.icon-remove').on ("click", function () {
                jQuery(this).parent(".tools").parent(".widget-title").parent(".widget").remove();
            });
         }

         function ocultarPortlet()
         {
            var obj = $(this).parent(".tools").parent(".widget-title").parent(".widget").find(".widget-body");
            if (jQuery(this).hasClass("icon-chevron-down")) {
                jQuery(this).removeClass("icon-chevron-down").addClass("icon-chevron-up");
                obj.slideUp(200);
            } else {
                jQuery(this).removeClass("icon-chevron-up").addClass("icon-chevron-down");
                obj.slideDown(200);
            }
         }
         $("#txtVerContratos_BuscarPor").chosen().change(function(evento, Objeto)
          {
            $.each(Objeto, function(index, value)
              {
                var str = value + ", ";
                if (index == "selected")
                {
                  $("#txtVerContratos_Parametros").val($("#txtVerContratos_Parametros").val() + str)
                } else
                {
                  $("#txtVerContratos_Parametros").val($("#txtVerContratos_Parametros").val().replace(str, ""));
                }
              });
            
          });

         $("#btnVerContratos_Buscar").click(function()
          {
            var pParametros = $("#txtVerContratos_Parametros").val();
            if (pParametros != "")
            {
                $.post("php/buscarContratos.php", {parametros: pParametros, criterio : $("#txtVerContratos_Criterio").val()}, function(data)
                {
                  if (data == 0)
                  {
                    Mensaje("Hey", "No se encontraron resultados");
                  } else
                  {
                    $("#txtVerContratos_ContenedorResultados div").remove();
                    var tds = "";
                    $.each(data, function(index, value)
                      {
                          tds += '<div class="span4">';
                          tds += '<div class="widget">';
                          tds += '   <div class="widget-title">';
                          tds += '       <h4><i class="icon-reorder"></i>' + value.Nombre + '</h4>';
                          tds += '       <span class="tools">';
                          tds += '          <a class="icon-chevron-down" href="javascript:;"></a>';
                          tds += '          <a class="icon-remove" href="javascript:;"></a>';
                          tds += '       </span>';
                          tds += '   </div>';
                          tds += '   <div class="widget-body">';
                          tds += '       <div>';
                          tds += '           <b>Descripción:</b>' + value.Descripcion + '<br />';
                          tds += '           <b>Objeto:</b>' + value.Objeto + '<br />';
                          tds += '           <b>Contratante:</b>' + value.Contratante + '<br />';
                          tds += '           <b>Contratista:</b>' + value.Contratista + '<br />';
                          tds += '       </div>';
                          tds += '   </div>';
                          tds += '   <div class="form-actions">';
                          tds += '     <button id="objArchivos" class="btn btn-warning"><i class="icon-copy icon-white"></i> Archivos</button>';
                          tds += '     <button class="btn btn-info"><i class="icon-legal icon-white"></i> Pruebas</button>';
                          tds += '   </div>';
                          tds += '</div>';
                          tds += '</div>';
                      });

                    $("#txtVerContratos_ContenedorResultados").append(tds);
                    PortletDraggable.init();
                    cerrarPorlet();
                  }

                }, 'json').always(function() 
                {
                  //Cuando Finaliza
                }).fail(function() {
                  Mensaje("Error", "No fue conectar con el Servidor");
                });
            } else
            {
              Mensaje("Hey", "Tienes que seleccionar por lo menos un parámetro");
            }
              
          });

      });
   </script>
   <!-- END JAVASCRIPTS -->   
</body>
<!-- END BODY -->
</html>